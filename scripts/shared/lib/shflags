# shellcheck shell=bash
# shellcheck source=scripts/shared/lib/source_only
. "${BASH_SOURCE%/*}"/source_only

ensure_shflags() {
    if [ -f /usr/share/shflags/shflags ]; then
      . /usr/share/shflags/shflags
      return
    fi

    if [ ! -s .shflags ]; then
        echo "Downloading shflags ${SHFLAGS_VERSION}"
        if ! curl -L "https://raw.githubusercontent.com/kward/shflags/v${SHFLAGS_VERSION}/shflags" > .shflags; then
            rm -f .shflags
            echo "$0 needs shflags in /usr/share/shflags/shflags or locally as .shflags." 1>&2
            echo "It was unable to download it; please install it and try again." 1>&2
            exit 1
        fi
    fi

    # Avoid failures because FLAGS_ARGC becomes read-only
    unset FLAGS_ARGC
    . ./.shflags
}

SHFLAGS_VERSION=${SHFLAGS_VERSION:=1.2.3}
ensure_shflags
